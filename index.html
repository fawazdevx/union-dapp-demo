<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Union Testnet Starter â€” Transfers & Faucets</title>
    <meta name="description" content="Minimal Union testnet dashboard: latest cross-chain transfers via GraphQL + quick faucet & transfer links." />
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&display=swap" rel="stylesheet">
    <link rel="preconnect" href="https://graphql.union.build" crossorigin />
    <style>
      :root {
        --bg: #0b0f17;
        --card: rgba(18,24,38,.7);
        --muted: #9aa4b2;
        --text: #dbeafe;
        --accent: #0ff;
        --accent-2: #f0f;
        --ok: #34d399;
        --warn: #fbbf24;
        --err: #f87171;
      }
      * { box-sizing: border-box; }
      html, body { height: 100%; margin: 0; font-family: 'Orbitron', sans-serif; background-color: var(--bg); color: var(--text); }
      body {
        background: radial-gradient(ellipse at center, #0b0f17 0%, #000000 100%);
        background-image: repeating-linear-gradient(0deg, rgba(0,255,255,.05), rgba(0,255,255,.05) 1px, transparent 1px, transparent 2px), repeating-linear-gradient(90deg, rgba(255,0,255,.05), rgba(255,0,255,.05) 1px, transparent 1px, transparent 2px);
      }
      .container { max-width: 980px; margin: 0 auto; padding: 24px; }
      header { display: flex; gap: 16px; align-items: center; justify-content: space-between; margin-bottom: 20px; }
      .brand { display:flex; align-items:center; gap:12px; }
      .logo img { height:32px; vertical-align:middle; margin-left:4px; filter: drop-shadow(0 0 4px var(--accent)) drop-shadow(0 0 6px var(--accent-2)); }
      h1 { font-size: clamp(22px, 3.5vw, 32px); margin: 0; letter-spacing:.3px; color: var(--accent); text-shadow: 0 0 6px var(--accent), 0 0 12px var(--accent-2); }
      .actions { display:flex; gap: 10px; flex-wrap:wrap; }
      a.btn { text-decoration: none; padding: 10px 14px; border-radius: 12px; background: linear-gradient(135deg, var(--accent), var(--accent-2)); color: #000; font-weight: 700; text-shadow: 0 0 4px #000; display:inline-flex; align-items:center; gap:8px; border: none; box-shadow: 0 0 8px var(--accent), 0 0 16px var(--accent-2); transition: all .2s ease-in-out; }
      a.btn:hover { box-shadow: 0 0 16px var(--accent), 0 0 32px var(--accent-2), 0 0 48px var(--accent); transform: scale(1.05); }
      .grid { display:grid; grid-template-columns: 1fr; gap: 16px; }
      @media(min-width: 900px){ .grid { grid-template-columns: 1.4fr .6fr; } }
      .card { background: var(--card); border: 1px solid var(--accent); border-radius: 16px; padding: 16px; backdrop-filter: blur(6px); box-shadow: 0 0 12px var(--accent), 0 0 24px var(--accent-2); transition: transform .2s, box-shadow .3s; }
      .card:hover { transform: translateY(-3px); box-shadow: 0 0 16px var(--accent), 0 0 32px var(--accent-2); }
      .card h2 { margin: 0 0 12px; font-size: 18px; font-weight: 700; }
      .muted { color: var(--muted); font-size: 13px; }
      .table { width: 100%; border-collapse: collapse; font-size: 14px; }
      .table th, .table td { padding: 10px 8px; border-bottom: 1px solid #1f2937; vertical-align: top; }
      .table th { text-align: left; color: var(--accent-2); font-weight: 600; font-size: 12px; letter-spacing:.2px; }
      .pill { padding: 2px 8px; border-radius: 999px; border:1px solid var(--accent-2); color: var(--accent-2); font-size:12px; }
      .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
      footer { margin-top: 24px; color: var(--muted); font-size: 12px; text-align:center; }
      .small { font-size: 12px; }
      .row { display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
      .spinner { width: 18px; height: 18px; border: 3px solid #25314d; border-top-color: var(--accent); border-radius: 50%; animation: spin .8s linear infinite; }
      @keyframes spin { to { transform: rotate(360deg);} }
      .error { color: var(--err); }
      .success { color: var(--ok); }
      .caption { display: flex; align-items: center; justify-content: space-between; margin-bottom:8px; }
      .kbd { border: 1px solid #334155; border-bottom-width: 2px; border-radius: 8px; padding: 2px 6px; font-weight: 700; background:#0b1222; }
      input.mono { border: 1px solid var(--accent); background: rgba(0,0,0,.3); color: var(--accent); box-shadow: 0 0 6px var(--accent); }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <div class="brand">
          <div class="logo"><img src="https://union.build/favicon.ico" alt="Union"></div>
          <div>
            <h1>Union Testnet Starter</h1>
            <div class="muted small">Live transfers from <span class="mono">graphql.union.build</span> + quick actions</div>
          </div>
        </div>
        <div class="actions">
          <a class="btn" href="https://app.union.build/transfer" target="_blank" rel="noopener">ðŸš€ Try a Transfer</a>
          <a class="btn" href="https://app.union.build/faucet" target="_blank" rel="noopener">ðŸ’§ Get Testnet Tokens</a>
          <a class="btn" href="https://docs.union.build/" target="_blank" rel="noopener">ðŸ“š Docs</a>
        </div>
      </header>

      <div class="grid">
        <section class="card" id="transfers-card">
          <div class="caption">
            <h2>Latest Transfers</h2>
            <div class="row muted small"><div class="spinner" id="loading-indicator" aria-hidden="true"></div><span id="status-text">Loadingâ€¦</span></div>
          </div>
          <table class="table" id="transfers-table" aria-live="polite">
            <thead>
              <tr>
                <th>From â†’ To</th>
                <th>Sender â†’ Receiver</th>
                <th>Amount</th>
              </tr>
            </thead>
            <tbody id="tbody"></tbody>
          </table>
          <div class="row" style="justify-content:space-between; margin-top:10px;">
            <div class="muted small">Auto-refreshes every <span class="kbd">5s</span>. Caches with <span class="kbd">@cached(ttl:1)</span>.</div>
            <div class="row">
              <button id="prev" class="btn" disabled>â—€ Prev</button>
              <button id="next" class="btn" disabled>Next â–¶</button>
            </div>
          </div>
        </section>

        <aside class="card">
          <h2>Quick Start</h2>
          <ol class="small" style="line-height:1.6">
            <li>Install <strong>Keplr</strong> (Cosmos) and an <strong>EVM wallet</strong> (e.g. MetaMask).</li>
            <li>Claim tokens at the <a href="https://app.union.build/faucet" target="_blank" rel="noopener">Union faucets</a>.</li>
            <li>Make a tiny cross-chain transfer in <a href="https://app.union.build/transfer" target="_blank" rel="noopener">Union App</a>.</li>
          </ol>
          <h2 style="margin-top:12px">Dev Links</h2>
          <ul class="small">
            <li><a href="https://docs.union.build/integrations/api/graphql/" target="_blank" rel="noopener">GraphQL guide</a></li>
            <li><a href="https://docs.union.build/integrations/typescript/" target="_blank" rel="noopener">TypeScript SDK</a></li>
            <li><a href="https://docs.union.build/ucs/00/" target="_blank" rel="noopener">UCS00 Ping-Pong (Hello World)</a></li>
          </ul>
          <h2 style="margin-top:12px">Your Address Filter</h2>
          <label class="small muted" for="addr">Filter by canonical address (sender or receiver)</label>
          <input id="addr" class="mono" placeholder="0xabcâ€¦ or cosmos1â€¦" style="width:100%; padding:10px; border-radius:10px;" />
          <button id="apply" class="btn" style="margin-top:8px; width:100%">Apply Filter</button>
          <p class="muted small" style="margin-top:8px">Tip: paste your EVM or Cosmos canonical address to see only your transfers.</p>
        </aside>
      </div>

      <footer>
        Built by <a href="https://github.com/fawazdevx" target="_blank" rel="noopener" style="color:var(--accent)">Unrealfdev</a>. Not affiliated with <a href="https://union.build/" target="_blank" rel="noopener" style="color:var(--accent)">Union</a>. Data via <span class="mono">graphql.union.build</span>.
      </footer>
    </div>

    <script>
      const ENDPOINT = "https://graphql.union.build/v1/graphql";
      const tbody = document.getElementById("tbody");
      const statusText = document.getElementById("status-text");
      const loading = document.getElementById("loading-indicator");
      const nextBtn = document.getElementById("next");
      const prevBtn = document.getElementById("prev");
      const addrInput = document.getElementById("addr");
      const applyBtn = document.getElementById("apply");

      let cursor = null;
      let comparison = null;
      let addressFilter = null;
      let intervalId = null;

      const GQL = {
        transfers: ({ limit = 20, sortOrder = null, comparison = null, address = null } = {}) => {
          const args = [];
          args.push(`p_limit: ${limit}`);
          if (sortOrder) args.push(`p_sort_order: "${sortOrder}"`);
          if (comparison) args.push(`p_comparison: "${comparison}"`);
          if (address) args.push(`p_addresses_canonical: ["${address}"]`);
          return `query GetTransfers @cached(ttl: 1) {\n  v2_transfers(args: { ${args.join(", ")} }) {\n    sender_canonical\n    receiver_canonical\n    base_amount\n    base_token_meta { denom representations { name symbol decimals } }\n    source_universal_chain_id\n    destination_universal_chain_id\n    sort_order\n  }\n}`;
        }
      };

      function nanoToDecimal(amount, decimals) {
        try {
          if (decimals == null) return amount;
          const v = BigInt(amount);
          const d = BigInt(10) ** BigInt(decimals);
          const whole = v / d;
          const frac = (v % d).toString().padStart(Number(decimals), '0').slice(0, 6);
          return `${whole}.${frac}`;
        } catch (e) { return amount; }
      }

      function renderRows(items) {
        tbody.innerHTML = "";
        for (const t of items) {
          const rep = (t.base_token_meta?.representations?.[0]) || { name: "", symbol: "", decimals: 18 };
          const amount = nanoToDecimal(t.base_amount, rep.decimals);
          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td class="small"><span class="pill">${t.source_universal_chain_id}</span> â†’ <span class="pill">${t.destination_universal_chain_id}</span></td>
            <td class="mono small">${t.sender_canonical.slice(0,10)}â€¦ â†’ ${t.receiver_canonical.slice(0,10)}â€¦</td>
            <td class="mono">${amount} <span class="muted">${rep.symbol || rep.name || ''}</span></td>
          `;
          tbody.appendChild(tr);
        }
      }

      async function fetchTransfers() {
        try {
          loading.style.visibility = 'visible';
          statusText.textContent = 'Loadingâ€¦';
          const query = GQL.transfers({ limit: 12, sortOrder: cursor, comparison, address: addressFilter });
          const res = await fetch(ENDPOINT, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ query })
          });
          const json = await res.json();
          const items = json?.data?.v2_transfers ?? [];
          renderRows(items);
          if (items.length) {
            prevBtn.disabled = false;
            nextBtn.disabled = false;
            nextBtn.dataset.cursor = items[items.length - 1].sort_order;
            prevBtn.dataset.cursor = items[0].sort_order;
          }
          statusText.textContent = `Loaded ${items.length} transfers`;
        } catch (e) {
          console.error(e);
          statusText.textContent = 'Failed to load';
          statusText.classList.add('error');
        } finally {
          loading.style.visibility = 'hidden';
        }
      }

      nextBtn.addEventListener('click', () => { cursor = nextBtn.dataset.cursor || null; comparison = 'lt'; fetchTransfers(); });
      prevBtn.addEventListener('click', () => { cursor = prevBtn.dataset.cursor || null; comparison = 'gt'; fetchTransfers(); });
      applyBtn.addEventListener('click', () => { const val = addrInput.value.trim(); addressFilter = val || null; cursor = null; comparison = null; fetchTransfers(); });
      function startAutoRefresh(){ if (intervalId) clearInterval(intervalId); intervalId = setInterval(fetchTransfers, 5000); }
      fetchTransfers();
      startAutoRefresh();
    </script>
  </body>
</html>
